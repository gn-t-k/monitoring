# 監視のデザインパターン

## デザインパターン1：組み合わせ可能な監視

- 専門化されたツールを複数使い、それらを疎に結合させて、監視「プラットフォーム」を作る
- 1つのツールややり方に長期間コミットする必要がない
  - あるツールがやり方に合わなくなったら、そのツールだけ別のツールに変えればよい
- アーキテクチャは複雑になるが、得られるコストのほうが大きい

### 監視サービスのコンポーネント

- 監視サービスには5つの要素がある。

#### データ収集

- データ収集には方法として「プッシュ」と「プル」がある
  - プル型は、中央サービスがリモートノードに対して、ノードの情報を送りつけてくるよう要求する
    - 中央サービスがスケジュールについて責任を持つ
    - 中央サービスがすべてのクライアントを把握してスケジュールし、応答をパースしなくてはならないので、スケールしにくい
  - プッシュ型は、クライアントがデータを他の場所に一定間隔あるいはイベントが発生したタイミングでプッシュする
    - スケールしやすい
  - どんなデータを集めるかによって「メトリクス」と「ログ」の2種類のデータがある

##### メトリクス

メトリクスには「カウンター」と「ゲージ」の2つの表現方法がある。

###### カウンター

- 増加していくメトリクス
- 例
  - webサイトに訪れる累計人数
  - ネットワークインターフェイスのトラフィック
- カウンターには上限があり、上限を超えてしまうと、カウンターは最初に戻りまた0から始まる

###### ゲージ

- ある時点の値
- 過去の値についてなんの情報もアタ会えてくれず、本来の値を推測するヒントもくれない
- ゲージの値を時系列に保存することで、あとから過去のデータを取り出したり、グラフにプロットしたりできる

##### ログ

#### データストレージ

#### 可視化

#### 分析とレポート

#### アラート

## デザインパターン2：ユーザー視点での監視

## デザインパターン3：作るのではなく買う

### 安いから

### あなたは（おそらく）監視ツールを設計する専門家ではないから

### SaaSを使うとプロダクトにフォーカスできるから

### 実際のところSaaSのほうがよいから

## デザインパターン4：継続的改善
