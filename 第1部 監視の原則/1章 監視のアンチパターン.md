# 1章_監視のアンチパターン

- 慣習は善意から始まる
- アンチパターンとは、一見よいアイディアだが実装すると手痛いしっぺ返しを食らうものを言う

## アンチパターン1：ツール依存

- ツール駆動なチームがミッション駆動なチームより効率的になることはない
  - ツールの機能や制限事項にとらわれてしまう
  - ミッション駆動であれば、必要なツールを作ってしまうこともある
- 銀の弾丸はない
  - 監視というのは大きく複雑な問題を扱うものなので、これらをすべてうまくやってくれるものはない

### 監視とは複雑な問題を一括にしたもの

- プロのメカニックが工具箱を持ち歩くように、汎用的あるいは専門化されたツールを組み合わせて使う
- 観察者効果は気にしない
  - 監視ツールがシステムに負荷を与えてしまうこと
  - エージェントレスな監視は柔軟性に欠ける
  - マシンスペック的に、気にするような問題じゃない
- ツールを増やすとシステムが複雑化する？
  - 賢く注意深く選ぶ前提で、必要なら増やしても問題ない
- ツールの勝手な採用を避けたい？
  - ツールを必要とする人と直接話をする

### カーゴ・カルトなツールを避ける

- 理屈を無視して形だけ真似ても、期待した効果は得られない
- 「成功したチームや会社は、ツールや手順によって成功したのだ」←間違い
- 他のチームがやっていることを真似するなということではない
  - 真似して、うまくいくかどうか試して、評価する、を繰り返す

### 自分でツールを作らなければならないときもある

- 「まったく新しい監視プラットフォームを作ろう」という話ではない
- 小さく、なにかに特化したツールを作ることで、効率よく問題を解決できることがある

### 「ひと目でわかる」は迷信

- 情報を1つのツールや1つのダッシュボードにまとめよう、という話ではなく、1つの「場所」にまとめようということ
- すべてを1つのツールあるいはダッシュボードに詰め込もうとするのは、効率的に仕事をしようとするのを妨げてしまうことになります
- **よくわからない**

## アンチパターン2：役割としての監視

- 組織の中の「監視の専門家」になるのは難しい
  - 監視対象についてよく知っていないとよい監視はできない
- 監視とは役割ではなくスキル（メンバー全員がある程度のレベルに至っておくべき）
- 各メンバーの専門分野について、最高の監視をしよう
- 監視するまでは本番環境とは言えない
- **「素晴らしいシグナル・ノイズ比」** ということは、ある程度ノイズも必要ということ？

## アンチパターン3：チェックボックス監視

- 「これを監視しています」というためだけの監視はNG

### 「動いている」とはどういう意味か。「動いている」かどうかを監視しよう

- たとえばwebアプリケーションならば、`GET /`して`HTTP 200 OK`が返ってきているかどうか
- サービスやアプリケーションに詳しくなれば、もっと多くのチェックやアラートを設定できるようになる

### アラートに関しては、OSのメトリクスはあまり意味がない

- DBが継続的にCPUを全部使っていたとしても、レスポンスタイムが許容範囲に収まっていれば何も問題はない
- とはいえ、負荷の急な変化やトレンドを確認することは大事
- 「動いているかどうか」でアラートを上げるかどうかを判断する

### メトリクスをもっと高頻度で取得しよう

- 最低でも60秒に1回はメトリクスを取得する

## アンチパターン4：監視を支えにする

- 監視を増やしても壊れたシステムが直るわけではない
- 「アラートが来たからバグを修正」が日常的になっているようであれば、「アラートが来たら」じゃなくていったんシステムのリファクターとかリプレースとかをしっかりやったほうがいい

## アンチパターン5：手動設定

- **ここで書いてる「設定」って具体的になにのことを言っている？**
- 新しいメトリクスなどを追加するときに、毎回同じ作業をしているならその作業を自動化するということ？
